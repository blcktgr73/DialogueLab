보내주신 로그를 보니 **DialogueLab** 프로젝트에서 Google STT API를 호출할 때 발생한 문제의 핵심은 **`413 Content Too Large`** 에러입니다.

현재 Vercel 환경에서 발생하고 있는 이 에러의 원인과 해결 방법을 정리해 드립니다.

### 1. 에러의 주요 원인

* **Vercel의 Serverless Functions 제한:** Vercel의 무료(Hobby) 플랜이나 유료(Pro) 플랜 모두 **결과(Payload) 크기 제한**이 있습니다. 일반적으로 요청/응답 본문 크기가 **4.5MB**를 초과하면 Vercel 인프라 단에서 `413` 에러를 뱉으며 요청을 차단합니다.
* **녹음 데이터 크기:** `Recorder`가 생성한 `audio/webm` 파일이 Vercel의 이 제한을 초과한 것으로 보입니다. (로그상의 긴 입력 볼륨 데이터로 보아 녹음 시간이 다소 길었던 것 같습니다.)

---

### 2. 해결 방법

#### 방법 A: 요청 본문 크기 제한 설정 (Next.js 사용 시)

만약 Next.js의 API Route를 사용 중이라면, 해당 API 파일에서 기본으로 설정된 4MB 제한을 상향 조정할 수 있습니다. 하지만 **Vercel 자체의 인프라 제한(4.5MB)**은 넘길 수 없으므로 주의해야 합니다.

```javascript
// api/stt.js 파일 상단에 추가
export const config = {
  api: {
    bodyParser: {
      sizeLimit: '10mb', // 원하는 크기로 조절 (단, Vercel 인프라 제한에 걸릴 수 있음)
    },
  },
};

```

#### 방법 B: 클라이언트 단에서 압축 또는 분할

가장 권장되는 방식입니다. 오디오 데이터를 서버로 보내기 전에 처리하는 방법입니다.

1. **샘플 레이트 조정:** 녹음 시 오디오의 `sampleRate`를 낮춰 파일 용량을 줄입니다.
2. **청크(Chunk) 전송:** 긴 녹음 데이터를 일정 시간 단위(예: 10초)로 나누어 서버에 여러 번 전송합니다.

#### 방법 C: Vercel을 거치지 않고 직접 API 호출

Vercel 서버리스 함수를 "프록시"로 사용하지 말고, **클라이언트(브라우저)에서 직접 Google STT API**를 호출하거나, 파일을 먼저 **Supabase Storage**에 업로드한 뒤 해당 URL을 서버에 전달하여 처리하게 합니다.

#### 방법 D: 로컬 서버 활용 (현재 환경 최적화)

사용자께서 최근 **미니 PC로 환경을 이전(Migration)** 중이신 것으로 알고 있습니다. Vercel의 제한이 까다롭다면, 로컬 미니 PC에서 구동 중인 서버(예: n8n 또는 Docker 기반 백엔드)로 STT 요청을 보내도록 엔드포인트를 변경하는 것도 좋은 전략입니다. 로컬 환경은 이러한 Payload 제한에서 훨씬 자유롭습니다.

---

### 다음 단계 제안

혹시 현재 **DialogueLab** 프로젝트의 API 코드를 직접 수정할 수 있는 상황이신가요? `api/stt` 내부에서 Google Cloud Storage를 활용하는 방식으로 구조를 변경하거나, 클라이언트 단의 녹음 설정을 변경하는 로직이 필요하시다면 해당 코드의 일부를 공유해 주세요. 최적의 수정안을 짜드리겠습니다.

